cmake_minimum_required(VERSION 3.15)
project(audioplayer)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

set(CMAKE_SKIP_BUILD_RPATH TRUE)
set(CMAKE_SKIP_INSTALL_RPATH TRUE)

if(NOT DEFINED NUKE_VERSION)
    set(NUKE_VERSION "16.0v6")
endif()
set(NDKDIR /opt/Nuke${NUKE_VERSION})

if(NOT EXISTS ${NDKDIR})
    message(FATAL_ERROR "Nuke not found: ${NDKDIR}")
endif()

add_compile_options(-fPIC -O2)
set(CMAKE_SHARED_LIBRARY_PREFIX "")

add_library(audioplayer SHARED
    src/audioplayer.cpp
    src/audioHandler.cpp
)

target_include_directories(audioplayer PUBLIC
    ${NDKDIR}/include
    ${NDKDIR}/include/python3.11
    ${CMAKE_SOURCE_DIR}/include
)

target_link_libraries(audioplayer PRIVATE
    ${NDKDIR}/libDDImage.so
    pthread dl m
)

install(TARGETS audioplayer DESTINATION ${CMAKE_INSTALL_PREFIX})

message(STATUS "AudioPlayer v2.5 for Nuke ${NUKE_VERSION}")
